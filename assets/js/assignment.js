const firebaseConfig={apiKey:"AIzaSyDsE3S6NdSB_BO03pHBA3VVkCo6RWn-3Tw",authDomain:"ssoak-72f93.firebaseapp.com",projectId:"ssoak-72f93",storageBucket:"ssoak-72f93.appspot.com",messagingSenderId:"998236238275",appId:"1:998236238275:web:254b37e7a33448259ecd76",databaseURL:"https://ssoak-72f93-default-rtdb.firebaseio.com"};firebase.initializeApp(firebaseConfig);var database=firebase.database();grade&&classNum?($("#assignments-listview").show(),$("#before-setting-assign").hide()):($("#assignments-listview").hide(),$("#before-setting-assign").show());var selectedDateAssign=new Date;$("#date_assign").on("change",(function(){var e=moment(new Date($(this).val())).format("YYYYMMDD");selectedDateAssign=new Date($(this).val()),$(".timetable_selector").html("해당 날짜의 시간표를 불러오는 중입니다."),$.ajax({type:"GET",url:"https://sungil-school-api.vercel.app/dayTimetable?date="+e+"&grade="+grade+"&classNum="+classNum,success:function(e){var s=JSON.parse(e);if(console.log(s),s.timetable){$(".timetable_selector").html("");for(var t=0;t<s.timetable.length;t++)$(".timetable_selector").append('\n                    <div class="item" data-period="'+(t+1)+'">\n                    <h6>'+(t+1)+"교시</h5>\n                    <h5>"+s.timetable[t].ITRT_CNTNT+"</h3>\n                    </div>");if("true"==storedTheme||"system"==storedTheme&&mql.matches){var a=document.getElementsByClassName("item");for(t=0;t<a.length;t++)a[t].classList.add("dark")}}else $(".timetable_selector").html("선택한 날짜에는 수업이 없어요.");setTimeout((function(){$(".sheet-modal").css("height",$("#assessment").height()+130+"px")}),100)}})}));var selectedPeriod=null,selctedSubject=null;$(".timetable_selector").on("click",".item",(function(){$(".timetable_selector .item").removeClass("active"),$(this).addClass("active"),selectedPeriod=$(this).attr("data-period"),selctedSubject=$(this).find("h3").text()})),$("#myclassAssign-listview").on("click",".item",(function(){var e={id:Math.random().toString(36).substr(2,9),title:$(this).find("h4").text(),date:$(this).find(".assign-date").text(),period:$(this).find(".time").text().substring(0,1),subject:$(this).find(".time").text().substring(4,$(this).find(".time").text().length),grade:grade,classNum:classNum};assignArr.push(e),assignArr.sort(((e,s)=>new Date(s.date)-new Date(e.date))),localStorage.setItem("assignments",JSON.stringify(assignArr)),closeModal(),updateAssignList()}));var debug,selectedAssignId,assignArr=[];function addAssignment(){if($("#title").val())if($("#date_assign").val())if(selectedPeriod)if(selectedDateAssign<new Date)toast("이미 지난 날짜는 선택할 수 없습니다.");else{var e=Math.random().toString(36).substr(2,9),s={id:e,title:$("#title").val(),date:$("#date_assign").val(),period:selectedPeriod,subject:selctedSubject,grade:grade,classNum:classNum};assignArr.push(s),writeUserData(e,$("#title").val(),$("#date_assign").val(),selectedPeriod,selctedSubject),assignArr.sort(((e,s)=>new Date(s.date)-new Date(e.date))),localStorage.setItem("assignments",JSON.stringify(assignArr)),closeModal(),updateAssignList()}else toast("시행 날짜를 선택한 후 교시를 선택해주세요");else toast("시행 날짜를 선택해주세요");else toast("제목을 입력해주세요")}function editAssignment(){if($("#title").val())if($("#date_assign").val())if(selectedPeriod)if(selectedDateAssign<new Date)toast("이미 지난 날짜는 선택할 수 없습니다.");else{var e=JSON.parse(localStorage.getItem("assignments"))||[],s=e.find((e=>e.id==selectedAssignId));s.title=$("#title").val(),s.date=$("#date_assign").val(),s.period=selectedPeriod,s.subject=selctedSubject,s.grade=grade,s.classNum=classNum,e.sort(((e,s)=>new Date(s.date)-new Date(e.date))),assignArr=e,localStorage.setItem("assignments",JSON.stringify(e)),closeModal(),updateAssignList()}else toast("시행 날짜를 선택한 후 교시를 선택해주세요");else toast("시행 날짜를 선택해주세요");else toast("제목을 입력해주세요")}function closeModal(){$("body").css("overflow","auto"),$(".modal-in").css("bottom","-1850px"),setTimeout((function(){$(".modal-in").css("display","none")}),100),$(".sheet-backdrop").removeClass("backdrop-in")}function updateAssignList(){assignArr=[],$("#assignments-listview").html(""),assignArr=JSON.parse(localStorage.getItem("assignments"))||[];var e=JSON.parse(localStorage.getItem("assignments"))||[];if(e.sort(((e,s)=>new Date(e.date)-new Date(s.date))),0==e.length&&grade&&classNum)$("#assignments-listview").html('<p style="height:100%;display:flex;text-align:center;justify-content: center;align-items: center;flex-direction: column;background:none;">\n                    <img class="no-meal-img" src="assets/icons/Empty-BOX.png" alt="수행 평가 없음 일러스트">\n                    <span>아직 추가한 수행평가가 없어요</span>\n                </p>');else for(var s=0;s<e.length;s++)if(new Date(e[s].date)<new Date){var t=e.find((t=>t.id==e[s].id));e.splice(e.indexOf(t),1),localStorage.setItem("assignments",JSON.stringify(e))}else $("#assignments-listview").append('\n            <div class="task-box" onclick="openAssignDetails(\''+e[s].id+'\');">\n            <div class="assign-date">'+moment(new Date(e[s].date)).format("MM/DD")+'<br><span style="font-size:15px;opacity:0.6">D-'+fromToday(new Date(e[s].date))+'</span></div>\n            <div class="description-task">\n                <div class="time">'+e[s].period+"교시 "+e[s].subject+'</div>\n                <div class="task-name">'+e[s].title+"</div>\n            </div>\n            </div>");if("true"==storedTheme||"system"==storedTheme&&mql.matches){var a=document.getElementsByClassName("task-box");for(s=0;s<a.length;s++)a[s].classList.add("dark")}}function fromToday(e){var s=new Date,t=e.getTime()-s.getTime(),a=Math.ceil(t/864e5);return console.log(s,e),0==a&&(a="DAY"),a}function openAssignDetails(e){selectedAssignId=e;var s=JSON.parse(localStorage.getItem("assignments")).find((s=>s.id==e));$(".sheet-modal").css("height","30%"),$("#modal-title").html(s.title+'&nbsp;&nbsp;<a onclick="javascript:assignEditMode();"><ion-icon name="create-outline"></ion-icon></a>&nbsp;<a onclick="javascript:assignDelete();"><ion-icon name="trash-outline"></ion-icon></a>'),$(".content-wrap").hide(),$("#assignDetails").show(),$("#assignDate").html('<ion-icon name="time-outline"></ion-icon>'+moment(new Date(s.date)).format("YYYY년 MM월 DD일")),$("#assignPeriod").text(s.period+"교시 "+s.subject),$("body").css("overflow","hidden"),$(".modal-in").css("display","block"),$(".modal-in").css("bottom","-1850px"),setTimeout((function(){$(".modal-in").css("bottom","0px")}),100),$(".sheet-backdrop").addClass("backdrop-in"),setTimeout((function(){$(".sheet-modal").css("height",$("#assignDetails").height()+130+"px")}),100)}function assignEditMode(){var e=JSON.parse(localStorage.getItem("assignments")).find((e=>e.id==selectedAssignId));$(".sheet-modal").css("height","30%"),$("#modal-title").html("수행평가 추가"),$(".content-wrap").hide(),$("#assessment").show(),$("#assign-add-save-btn").hide(),$("#assign-edit-save-btn").show(),$("#title").val(e.title),$("#assessment #date_assign").val(moment(e.date).format("YYYY-MM-DD")),$(".timetable_selector").html("로딩중..."),$("#exam").hide(),$("body").css("overflow","hidden"),$(".modal-in").css("display","block"),$(".modal-in").css("bottom","-1850px");var s=moment(new Date($("#assessment #date_assign").val())).format("YYYYMMDD");$(".timetable_selector .item").removeClass("active"),$(this).addClass("active"),selectedDateAssign=new Date(e.date),selectedPeriod=e.period,selctedSubject=e.subject,$.ajax({type:"GET",url:"https://sungil-school-api.vercel.app/dayTimetable?date="+s+"&grade="+grade+"&classNum="+classNum,success:function(s){var t=JSON.parse(s);if(console.log(t),t.timetable){$(".timetable_selector").html("");for(var a=0;a<t.timetable.length;a++)a+1==e.period?$(".timetable_selector").append('\n                        <div class="item active" data-period="'+(a+1)+'">\n                        <h6>'+(a+1)+"교시</h5>\n                        <h5>"+t.timetable[a].ITRT_CNTNT+"</h3>\n                        </div>"):$(".timetable_selector").append('\n                            <div class="item" data-period="'+(a+1)+'">\n                            <h6>'+(a+1)+"교시</h5>\n                            <h5>"+t.timetable[a].ITRT_CNTNT+"</h3>\n                            </div>");if("true"==storedTheme||"system"==storedTheme&&mql.matches){var i=document.getElementsByClassName("item");for(a=0;a<i.length;a++)i[a].classList.add("dark")}}else $(".timetable_selector").html("선택한 날짜에는 수업이 없어요.");setTimeout((function(){$(".sheet-modal").css("height",$("#assessment").height()+130+"px")}),100)}}),setTimeout((function(){$(".modal-in").css("bottom","0px")}),100),$(".sheet-backdrop").addClass("backdrop-in"),setTimeout((function(){$(".sheet-modal").css("height",$("#assessment").height()+130+"px")}),100)}function assignDelete(){confirmDeleteAssignment()}async function confirmDeleteAssignment(){if(await ui.confirm("정말 삭제하시겠습니까?")){var e=JSON.parse(localStorage.getItem("assignments")),s=e.findIndex((e=>e.id==selectedAssignId));e.splice(s,1),assignArr=e,localStorage.setItem("assignments",JSON.stringify(e)),closeModal(),updateAssignList()}}function writeUserData(e,s,t,a,i){database.ref("assignments/"+grade+"/"+classNum+"/"+e).set({id:e,title:s,date:t,period:a,subject:i})}function openClassAssign(){var e=0;$(".sheet-modal").css("height","30%"),$("#modal-title").html("우리 반 수행평가"),$(".content-wrap").hide(),$("#myClassAssign").show(),$("#assign-add-save-btn").hide(),$("#assign-edit-save-btn").show(),$("body").css("overflow","hidden"),$(".modal-in").css("display","block"),$(".modal-in").css("bottom","-1850px"),setTimeout((function(){$(".modal-in").css("bottom","0px")}),100),$(".sheet-backdrop").addClass("backdrop-in"),firebase.database().ref("assignments/"+grade+"/"+classNum).once("value").then((s=>{console.log(s.val());var t=s.val();if(t){var a=Object.keys(t);$("#myclassAssign-listview").html("");for(var i=0;i<a.length;i++)e++,new Date(t[a[i]].date)<new Date?firebase.database().ref("assignments/"+grade+"/"+classNum+"/"+a[i]).remove():$("#myclassAssign-listview").append('<div class="item" data-id="'+a[i]+'">\n                    <div>\n                        <h4>'+t[a[i]].title+'</h4>\n                        <div class="assign-date">'+moment(t[a[i]].date).format("YYYY-MM-DD")+'</div>\n                        <div class="time">'+t[a[i]].period+"교시 "+t[a[i]].subject+'</div>\n                    </div>\n                    <ion-icon name="add-outline"></ion-icon>\n                    </div>')}else $("#myclassAssign-listview").html("친구들이 추가한 수행평가가 아직 없어요");setTimeout((function(){e<5?($("#myclassAssign-listview").css("height","100%"),$(".sheet-modal").css("height",$("#myclassAssign-listview").height()+130+"px")):(console.log($("#myClassAssign").height()),$(".sheet-modal").css("height","60%"),$("#myclassAssign-listview").css("height",$(".sheet-modal").height()-130+"px")),$("#myclassAssign-listview").scrollTop(0)}),200)}))}updateAssignList();